/*
 Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function m(a,b){var c=0,f;for(f in b)if(b[f]==a){c=1;break}return c}var i="",q=function(){var a=this,b=function(){var f=a.config,b={};b.srcNodeRef=a.document.getWindow().$.frameElement;b.assocApp="CKEDITOR."+CKEDITOR.version+"@"+CKEDITOR.revision;b.customerid=f.scayt_customerid||"1:WvF0D4-UtPqN1-43nkD4-NKvUm2-daQqk3-LmNiI-z7Ysb4-mwry24-T8YrS3-Q2tpq2";b.customDictionaryIds=f.scayt_customDictionaryIds||"";b.userDictionaryName=f.scayt_userDictionaryName||"";b.sLang=f.scayt_sLang||"en_US";
b.onLoad=function(){CKEDITOR.env.ie&&8>CKEDITOR.env.version||this.addStyle(this.selectorCss(),"padding-bottom: 2px !important;");a.editable().hasFocus&&!d.isControlRestored(a)&&this.focus()};b.onBeforeChange=function(){d.getScayt(a)&&!a.checkDirty()&&setTimeout(function(){a.resetDirty()},0)};f=window.scayt_custom_params;if("object"==typeof f)for(var c in f)b[c]=f[c];d.getControlId(a)&&(b.id=d.getControlId(a));var e=new window.scayt(b);e.afterMarkupRemove.push(function(a){(new CKEDITOR.dom.element(a,
e.document)).mergeSiblings()});if(b=d.instances[a.name])e.sLang=b.sLang,e.option(b.option()),e.paused=b.paused;d.instances[a.name]=e;try{e.setDisabled(!1===d.isPaused(a))}catch(k){}a.fire("showScaytState")};a.on("contentDom",b);a.on("contentDomUnload",function(){for(var a=CKEDITOR.document.getElementsByTag("script"),b=/^dojoIoScript(\d+)$/i,c=/^https?:\/\/svc\.webspellchecker\.net\/spellcheck\/script\/ssrv\.cgi/i,d=0;d<a.count();d++){var k=a.getItem(d),v=k.getId(),g=k.getAttribute("src");v&&(g&&v.match(b)&&
g.match(c))&&k.remove()}});a.on("beforeCommandExec",function(b){if(("source"==b.data.name||"newpage"==b.data.name)&&"wysiwyg"==a.mode){if(b=d.getScayt(a))d.setPaused(a,!b.disabled),d.setControlId(a,b.id),b.destroy(!0),delete d.instances[a.name]}else"source"==b.data.name&&"source"==a.mode&&d.markControlRestore(a)});a.on("afterCommandExec",function(b){d.isScaytEnabled(a)&&"wysiwyg"==a.mode&&("undo"==b.data.name||"redo"==b.data.name)&&window.setTimeout(function(){d.getScayt(a).refresh()},10)});a.on("destroy",
function(a){var a=a.editor,b=d.getScayt(a);b&&(delete d.instances[a.name],d.setControlId(a,b.id),b.destroy(!0))});a.on("afterSetData",function(){d.isScaytEnabled(a)&&window.setTimeout(function(){var b=d.getScayt(a);b&&b.refresh()},10)});a.on("insertElement",function(){var b=d.getScayt(a);d.isScaytEnabled(a)&&(CKEDITOR.env.ie&&a.getSelection().unlock(!0),window.setTimeout(function(){b.focus();b.refresh()},10))},this,null,50);a.on("insertHtml",function(){var b=d.getScayt(a);d.isScaytEnabled(a)&&(CKEDITOR.env.ie&&
a.getSelection().unlock(!0),window.setTimeout(function(){b.focus();b.refresh()},10))},this,null,50);a.on("scaytDialog",function(b){b.data.djConfig=window.djConfig;b.data.scayt_control=d.getScayt(a);b.data.tab=i;b.data.scayt=window.scayt});var c=a.dataProcessor;(c=c&&c.htmlFilter)&&c.addRules({elements:{span:function(a){if(a.attributes["data-scayt_word"]&&a.attributes["data-scaytid"])return delete a.name,a}}});c=CKEDITOR.plugins.undo.Image.prototype;c.equals=CKEDITOR.tools.override(c.equals,function(a){return function(b){var c=
this.contents,e=b.contents,k=d.getScayt(this.editor);k&&d.isScaytReady(this.editor)&&(this.contents=k.reset(c)||"",b.contents=k.reset(e)||"");k=a.apply(this,arguments);this.contents=c;b.contents=e;return k}});a.document&&b()};CKEDITOR.plugins.scayt={engineLoaded:!1,instances:{},controlInfo:{},setControlInfo:function(a,b){a&&(a.name&&"object"!=typeof this.controlInfo[a.name])&&(this.controlInfo[a.name]={});for(var c in b)this.controlInfo[a.name][c]=b[c]},isControlRestored:function(a){return a&&a.name&&
this.controlInfo[a.name]?this.controlInfo[a.name].restored:!1},markControlRestore:function(a){this.setControlInfo(a,{restored:!0})},setControlId:function(a,b){this.setControlInfo(a,{id:b})},getControlId:function(a){return a&&a.name&&this.controlInfo[a.name]&&this.controlInfo[a.name].id?this.controlInfo[a.name].id:null},setPaused:function(a,b){this.setControlInfo(a,{paused:b})},isPaused:function(a){if(a&&a.name&&this.controlInfo[a.name])return this.controlInfo[a.name].paused},getScayt:function(a){return this.instances[a.name]},
isScaytReady:function(a){return!0===this.engineLoaded&&"undefined"!==typeof window.scayt&&this.getScayt(a)},isScaytEnabled:function(a){return(a=this.getScayt(a))?!1===a.disabled:!1},getUiTabs:function(a){var b=[],a=a.config.scayt_uiTabs||"1,1,1",a=a.split(",");a[3]="1";for(var c=0;4>c;c++)b[c]="undefined"!=typeof window.scayt&&"undefined"!=typeof window.scayt.uiTags?parseInt(a[c],10)&&window.scayt.uiTags[c]:parseInt(a[c],10);return b},loadEngine:function(a){if(CKEDITOR.env.gecko&&10900>CKEDITOR.env.version||
CKEDITOR.env.opera||CKEDITOR.env.air)return a.fire("showScaytState");if(!0===this.engineLoaded)return q.apply(a);if(-1==this.engineLoaded)return CKEDITOR.on("scaytReady",function(){q.apply(a)});CKEDITOR.on("scaytReady",q,a);CKEDITOR.on("scaytReady",function(){this.engineLoaded=!0},this,null,0);this.engineLoaded=-1;var b=document.location.protocol,b=-1!=b.search(/https?:/)?b:"http:",b=a.config.scayt_srcUrl||b+"//svc.webspellchecker.net/scayt26/loader__base.js",c=d.parseUrl(b).path+"/";void 0==window.scayt?
(CKEDITOR._djScaytConfig={baseUrl:c,addOnLoad:[function(){CKEDITOR.fireOnce("scaytReady")}],isDebug:!1},CKEDITOR.document.getHead().append(CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",async:"true",src:b}}))):CKEDITOR.fireOnce("scaytReady");return null},parseUrl:function(a){var b;return a.match&&(b=a.match(/(.*)[\/\\](.*?\.\w+)$/))?{path:b[1],file:b[2]}:a}};var d=CKEDITOR.plugins.scayt,t=function(a,b,c,d,j,m,e){a.addCommand(d,j);a.addMenuItem(d,{label:c,command:d,group:m,
order:e})},w={preserveState:!0,editorFocus:!1,canUndo:!1,exec:function(a){if(d.isScaytReady(a)){var b=d.isScaytEnabled(a);this.setState(b?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_ON);a=d.getScayt(a);a.focus();a.setDisabled(b)}else!a.config.scayt_autoStartup&&0<=d.engineLoaded&&(this.setState(CKEDITOR.TRISTATE_DISABLED),d.loadEngine(a))}};CKEDITOR.plugins.add("scayt",{requires:"menubutton,dialog",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en-au,en-ca,en-gb,en,eo,es,et,eu,fa,fi,fo,fr-ca,fr,gl,gu,he,hi,hr,hu,is,it,ja,ka,km,ko,lt,lv,mk,mn,ms,nb,nl,no,pl,pt-br,pt,ro,ru,sk,sl,sr-latn,sr,sv,th,tr,ug,uk,vi,zh-cn,zh",
icons:"scayt",beforeInit:function(a){var b=a.config.scayt_contextMenuItemsOrder||"suggest|moresuggest|control",c="";if((b=b.split("|"))&&b.length)for(var d=0;d<b.length;d++)c+="scayt_"+b[d]+(b.length!=parseInt(d,10)+1?",":"");a.config.menu_groups=c+","+a.config.menu_groups},init:function(a){var b=a.dataProcessor&&a.dataProcessor.dataFilter,c={elements:{span:function(a){var b=a.attributes;b&&b["data-scaytid"]&&delete a.name}}};b&&b.addRules(c);var f={},j={},p=a.addCommand("scaytcheck",w);CKEDITOR.dialog.add("scaytcheck",
CKEDITOR.getUrl(this.path+"dialogs/options.js"));b=d.getUiTabs(a);a.addMenuGroup("scaytButton");a.addMenuGroup("scayt_suggest",-10);a.addMenuGroup("scayt_moresuggest",-9);a.addMenuGroup("scayt_control",-8);var c={},e=a.lang.scayt;c.scaytToggle={label:e.enable,command:"scaytcheck",group:"scaytButton"};1==b[0]&&(c.scaytOptions={label:e.options,group:"scaytButton",onClick:function(){i="options";a.openDialog("scaytcheck")}});1==b[1]&&(c.scaytLangs={label:e.langs,group:"scaytButton",onClick:function(){i=
"langs";a.openDialog("scaytcheck")}});1==b[2]&&(c.scaytDict={label:e.dictionariesTab,group:"scaytButton",onClick:function(){i="dictionaries";a.openDialog("scaytcheck")}});c.scaytAbout={label:a.lang.scayt.about,group:"scaytButton",onClick:function(){i="about";a.openDialog("scaytcheck")}};a.addMenuItems(c);a.ui.add("Scayt",CKEDITOR.UI_MENUBUTTON,{label:e.title,title:CKEDITOR.env.opera?e.opera_title:e.title,modes:{wysiwyg:1},toolbar:"spellchecker,20",onRender:function(){p.on("state",function(){this.setState(p.state)},
this)},onMenu:function(){var b=d.isScaytEnabled(a);a.getMenuItem("scaytToggle").label=e[b?"disable":"enable"];var c=d.getUiTabs(a);return{scaytToggle:CKEDITOR.TRISTATE_OFF,scaytOptions:b&&c[0]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytLangs:b&&c[1]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytDict:b&&c[2]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,scaytAbout:b&&c[3]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}});a.contextMenu&&a.addMenuItems&&a.contextMenu.addListener(function(b,
c){if(!d.isScaytEnabled(a)||c.getRanges()[0].checkReadOnly())return null;var g=d.getScayt(a),r=g.getScaytNode();if(!r)return null;var h=g.getWord(r);if(!h)return null;var i=g.getLang(),h=window.scayt.getSuggestion(h,i);if(!h||!h.length)return null;for(var o in f){delete a._.menuItems[o];delete a.commands[o]}for(o in j){delete a._.menuItems[o];delete a.commands[o]}f={};j={};o=a.config.scayt_moreSuggestions||"on";var i=false,u=a.config.scayt_maxSuggestions;typeof u!="number"&&(u=5);!u&&(u=h.length);
for(var n=a.config.scayt_contextCommands||"all",n=n.split("|"),l=0,p=h.length;l<p;l=l+1){var s="scayt_suggestion_"+h[l].replace(" ","_"),q=function(a,b){return{exec:function(){g.replace(a,b)}}}(r,h[l]);if(l<u){t(a,"button_"+s,h[l],s,q,"scayt_suggest",l+1);j[s]=CKEDITOR.TRISTATE_OFF}else if(o=="on"){t(a,"button_"+s,h[l],s,q,"scayt_moresuggest",l+1);f[s]=CKEDITOR.TRISTATE_OFF;i=true}}if(i){a.addMenuItem("scayt_moresuggest",{label:e.moreSuggestions,group:"scayt_moresuggest",order:10,getItems:function(){return f}});
j.scayt_moresuggest=CKEDITOR.TRISTATE_OFF}if(m("all",n)||m("ignore",n)){t(a,"ignore",e.ignore,"scayt_ignore",{exec:function(){g.ignore(r)}},"scayt_control",1);j.scayt_ignore=CKEDITOR.TRISTATE_OFF}if(m("all",n)||m("ignoreall",n)){t(a,"ignore_all",e.ignoreAll,"scayt_ignore_all",{exec:function(){g.ignoreAll(r)}},"scayt_control",2);j.scayt_ignore_all=CKEDITOR.TRISTATE_OFF}if(m("all",n)||m("add",n)){t(a,"add_word",e.addWord,"scayt_add_word",{exec:function(){window.scayt.addWordToUserDictionary(r)}},"scayt_control",
3);j.scayt_add_word=CKEDITOR.TRISTATE_OFF}g.fireOnContextMenu&&g.fireOnContextMenu(a);return j});b=function(b){b.removeListener();CKEDITOR.env.opera||CKEDITOR.env.air||a.editable().isInline()?p.setState(CKEDITOR.TRISTATE_DISABLED):p.setState(d.isScaytEnabled(a)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)};a.on("showScaytState",b);a.on("instanceReady",b);if(a.config.scayt_autoStartup)a.on("instanceReady",function(){d.loadEngine(a)})},afterInit:function(a){var b,c=function(a){if(a.hasAttribute("data-scaytid"))return!1};
a._.elementsPath&&(b=a._.elementsPath.filters)&&b.push(c);a.addRemoveFormatFilter&&a.addRemoveFormatFilter(c)}})})();